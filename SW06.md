# 📘 Woche 6 – Daten säubern & transformieren

Diese Woche konzentriert sich auf das **Vorbereiten von Daten** für die Analyse:  
Fehlwerte, Umkodierungen, Duplikate, Gruppierungen, Binning, Zensierung, Stichproben und String-Manipulation mit Pandas.

---

## 1. 🧼 Umgang mit Fehlwerten (NaN)

### NaN erkennen
```python
df.isna()                # True/False für jede Zelle
df.isna().sum()          # Anzahl NaN pro Spalte
df.isna().mean()         # Anteil NaN pro Spalte
```

### NaN entfernen
```python
df.dropna()              # Zeilen mit NaN entfernen
df.dropna(axis=1)        # Spalten mit NaN entfernen
```

### NaN ersetzen
```python
df.fillna(0)             # Alle NaN mit 0 ersetzen
df['Lohn'].fillna(df['Lohn'].median())  # Mit Median ersetzen
```

---

## 2. 🧾 Duplikate erkennen & entfernen

- Zeilen, die vollständig identisch sind:
```python
df.duplicated().sum()       # Anzahl Duplikate
df.drop_duplicates()        # Duplikate löschen
```

- Eindeutigkeit des Index prüfen:
```python
df.index.is_unique          # True/False
```

---

## 3. 🔁 Werte umkodieren (replace)

Beispiel: Zivilstand umbenennen:
```python
mapping = {'v': 'verh', 'vw': 'verw'}
df['Zivilstand'].replace(mapping, inplace=True)
```

---

## 4. 🏷️ Spalten umbenennen

```python
df.rename(columns={'Lohn': 'Monatslohn'}, inplace=True)
```

---

## 5. 📊 Gruppierung / Binning (z. B. Altersklassen)

### Beispiel: Altersklassen in 10-Jahres-Schritte
```python
bins = range(15, 66, 10)
df['Altersklasse'] = pd.cut(df['Alter'], bins)
```

### Absolute Häufigkeit:
```python
df['Altersklasse'].value_counts().sort_index()
```

### Relative Häufigkeit:
```python
df['Altersklasse'].value_counts(normalize=True).sort_index()
```

---

## 6. ✂️ Zensierung (Clip)

Beispiel: Werte über dem 95%-Quantil begrenzen
```python
p95 = df['Lohn'].quantile(0.95)
df['Lohn'] = df['Lohn'].clip(upper=p95)
```

---

## 7. 📉 Histogramm erstellen

Verteilung (z. B. von Löhnen) anzeigen:
```python
df['Lohn'].hist()
```

---

## 8. 🧪 Stichprobe ziehen

Beispiel: 5% Zufallsstichprobe (ohne Zurücklegen)
```python
sample = df.sample(frac=0.05, random_state=10)
```

---

## 9. 🧠 Dummy-Variablen erzeugen

### Automatisch:
```python
pd.get_dummies(df, columns=['Geschlecht'], drop_first=True)
```

### Manuell für „w“ (Frau):
```python
df['Geschlecht_w'] = (df['Geschlecht'] == 'w').astype(int)
```

---

## 10. 🔤 String-Operationen mit `str`

Beispiel-String:
```python
s = 'peter_vogt@test.com, m.mueller@test.com, banz(at)zhaw.ch'
emails = s.split(', ')
```

### In Pandas Series umwandeln:
```python
emails = pd.Series(emails)
```

### Zeichen ersetzen:
```python
emails.str.replace('(at)', '@', regex=False)
```

### Stringprüfung:
```python
emails.str.endswith('.ch')        # Gibt Series mit True/False
emails.str.endswith('.ch').sum()  # Zählt Einträge mit '.ch'
```

---

## ✅ Fazit Woche 6

In dieser Woche hast du zentrale Werkzeuge für die **Datenbereinigung & -transformation** gelernt:

- **Fehlwerte erkennen, entfernen oder ersetzen**
- **Duplikate & Inkonsistenzen behandeln**
- **Gruppieren & Binning (z. B. Altersklassen)**
- **Zensierung extremer Werte (Quantile)**
- **Zufallsstichproben ziehen**
- **Dummy-Variablen erzeugen**
- **Stringmanipulationen für Textdaten**

Diese Techniken sind essenziell für eine korrekte Datenanalyse und bereiten deine Daten auf statistische Verfahren und Visualisierungen vor.
