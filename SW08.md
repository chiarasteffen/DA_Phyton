# ğŸ“˜ Woche 8 â€“ Daten verknÃ¼pfen & umformen mit Pandas

In dieser Woche lernst du, wie man:
- DataFrames **zusammenfÃ¼gt** (`concat`, `merge`, `join`)
- **Mehrdimensionale Indizes** (hierarchisch) verwendet
- Daten von **Long-Format ins Wide-Format** transformiert (`pivot`, `unstack`)
- Spalten transformiert und logisch kombiniert

---

## 1. ğŸ§© Daten verbinden mit `concat()`

### Zwei DataFrames untereinander zusammenfÃ¼gen (Zeilenweise):
```python
df = pd.concat([df2020, df2021])
```

> Voraussetzung: gleiche Spaltenstruktur

---

## 2. ğŸ”— Daten verbinden mit `merge()`

### Join via Spalte â€Personâ€œ:
```python
pd.merge(dflohn, dfsektor, on='Person', how='left')
```

**Wichtige Argumente:**
- `on`: SchlÃ¼sselspalte(n)
- `how`: Join-Art (`left`, `right`, `inner`, `outer`)

### Wenn Index verwendet wird:
```python
dflohn.merge(dfsektor, left_index=True, right_index=True, how='left')
```

---

## 3. ğŸ”— Daten verbinden mit `join()`

Ideal bei Index-basierten DataFrames:
```python
dflohn.join(dfsektor)
```

> Voraussetzung: Gemeinsamer **Index** (z.â€¯B. `Person`)

---

## 4. ğŸ§± Hierarchischer Index (MultiIndex)

### Beispiel:
```python
df.set_index(['Geschlecht', 'Zivilstand']).sort_index()
```

- Mehrstufiger Index ermÃ¶glicht Gruppierungen Ã¼ber mehrere Dimensionen
- Zugriff per `.loc[]`:
```python
df.loc['w']  # Alle Frauen
```

---

## 5. ğŸ“Š Gruppierungen mit `groupby()` und `level`

### Durchschnittlicher Lohn nach Geschlecht und Zivilstand:
```python
df.groupby(['Geschlecht', 'Zivilstand'])['Lohn'].mean()
```

Oder bei hierarchischem Index:
```python
df['Lohn'].groupby(level=['Geschlecht', 'Zivilstand']).mean()
```

---

## 6. ğŸ”„ Long-Format â†’ Wide-Format

### Mit `unstack()`:
```python
df.groupby(['Geschlecht', 'Zivilstand'])['Lohn'].mean().unstack(level='Geschlecht')
```

| Zivilstand | m       | w       |
|------------|---------|---------|
| g          | 7294.90 | 5188.20 |
| l          | 5050.20 | 7214.58 |
| v          | 6567.00 | 6082.07 |

### Mit `pivot()`:
```python
df.pivot(index='Zivilstand', columns='Geschlecht', values='Lohn')
```

---

## 7. ğŸ” Index ersetzen

```python
df.set_index('Person', inplace=True)
```

---

## 8. ğŸ“¦ Beispiel: Hierarchischer Index mit `drinks`-Datensatz

```python
df = pd.read_csv('drinksbycountry.csv', usecols=[0, 4, 5])
df = df.set_index(['continent', 'country'])
```

Zugriff auf Europa:
```python
df.loc['Europe'].head()
```

---

## 9. ğŸ§ª Bedingte Zuweisung & Transformation

### Alle negativen Werte ersetzen:
```python
df[df < 0] = 0
```

Nur in Spalte B:
```python
df.loc[df.B < 0, 'B'] = 0
```

### Spalte basierend auf anderer Spalte befÃ¼llen:
```python
df['B'] = np.where(df['A'] > 0, 1, -1)
```

Alternativ:
```python
df['B'] = np.sign(df['A'])
```

---

## 10. âŒ Wide-Format ist nicht immer sinnvoll

Beispiel:
```python
df.unstack(level=0)  # Jede Kategorie wird zu einer Spalte
```

> âš ï¸ Wenn jede Beobachtung nur einer Gruppe zugeordnet ist (z.â€¯B. ein Land = ein Kontinent), entsteht beim "unstacken" **viele NaN-Werte** â†’ ineffizient.

---

## âœ… Fazit Woche 8

Du kannst jetzt:

âœ… **DataFrames kombinieren** Ã¼ber Spalten oder Indizes  
âœ… **Hierarchische Indizes** nutzen und effizient gruppieren  
âœ… **Formatwechsel** zwischen Long und Wide meistern  
âœ… Daten **zielgerichtet manipulieren** und logisch verknÃ¼pfen  

Diese FÃ¤higkeiten sind essenziell fÃ¼r:
- saubere Datenvorbereitung
- flexible Analysen
- datenbankÃ¤hnliche Operationen in Pandas